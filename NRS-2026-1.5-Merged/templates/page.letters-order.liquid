{% comment %}
  Template for letter ordering page, using a section to select the source -indv collection.
{% endcomment %}

{% section 'collection-selector' %}
{% assign source_collection_handle = section.settings.source_collection | append: "-indv" %}
{% assign source_collection = collections[source_collection_handle] %}
{% if source_collection %}
  {% assign debug_message = "Source collection found: " | append: source_collection_handle %}
{% else %}
  {% assign debug_message = "No source collection found for handle: " | append: source_collection_handle %}
{% endif %}

<div class="page-order-page">
  <h1>{{ page.title }}</h1>
  <p>{{ debug_message }}</p> <!-- Debug output -->
  {% if source_collection.image %}
    <img src="{{ source_collection.image.src | img_url: 'large' }}" alt="{{ page.title }} Image" class="collection-image">
  {% elsif collection.image %}
    <img src="{{ collection.image.src | img_url: 'large' }}" alt="{{ page.title }} Image" class="collection-image">
  {% endif %}
  {% if source_collection.description != blank %}
    <p>{{ source_collection.description }}</p>
  {% endif %}

  {% include 'letters-order-form', source_collection: source_collection %}

  <!-- Tabs section parsed from collection description -->
  {% if source_collection.description != blank %}
    <div class="tabs">
      {% assign description_lines = source_collection.description | split: '\n' %}
      {% for line in description_lines %}
        {% if line contains '<div id="' %}
          {{ line | strip }}
        {% endif %}
      {% endfor %}
    </div>
  {% endif %}

  <!-- Allow adding Ella sections for additional custom content -->
  {% section 'rich-text' %}
</div>