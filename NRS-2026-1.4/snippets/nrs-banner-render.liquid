{% comment %} 
  Snippet: snippets/nrs-banner-render.liquid 
  Fixes: Split Padding logic for Banners.
{% endcomment %}

{%- assign banner_style = "" -%}
{%- assign pad_v = block.settings.cont_pad_v | default: 40 -%}
{%- assign pad_h = block.settings.cont_pad_h | default: 40 -%}

{%- comment %} --- CONTENT ALIGNMENT LOGIC --- {% endcomment -%}
{%- assign align_items = "flex-start" -%}
{%- assign text_align = "left" -%}

{%- case block.settings.content_align -%}
  {%- when 'center' -%}
    {%- assign align_items = "center" -%}
    {%- assign text_align = "center" -%}
  {%- when 'right' -%}
    {%- assign align_items = "flex-end" -%}
    {%- assign text_align = "right" -%}
{%- endcase -%}

{%- if is_vertical -%}
  {%- comment %} --- VERTICAL BANNER LOGIC --- {% endcomment -%}
  {%- assign width_val = block.settings.width_val | default: 300 -%}
  {%- if block.settings.width_unit == 'px' -%}
    {%- assign banner_style = "width: " | append: width_val | append: "px;" -%}
  {%- else -%}
    {%- assign banner_style = "width: " | append: width_val | append: "%;" -%}
  {%- endif -%}
  {%- assign banner_style = banner_style | append: " align-self: stretch; height: auto; flex: 0 0 auto;" -%}

  {%- comment %} Vertical Background Crop {% endcomment -%}
  {%- assign bg_crop_pos = block.settings.img_position | default: 'center' -%}

{%- else -%}
  {%- comment %} --- HORIZONTAL BANNER LOGIC --- {% endcomment -%}
  {%- if block.settings.height_mode == 'fixed' -%}
    {%- assign unit = block.settings.height_unit | default: 'px' -%}
    {%- assign banner_style = "width: 100%; height: " | append: block.settings.height_value | append: unit | append: "; flex-shrink: 0;" -%}
  {%- else -%}
    {%- assign banner_style = "width: 100%; height: auto; min-height: 150px; flex-shrink: 0;" -%}
  {%- endif -%}
  
  {%- assign bg_crop_pos = 'center' -%}
{%- endif -%}

<div class="nrs-banner" style="{{ banner_style }} background-color: {{ block.settings.bg_color }}; position: relative; overflow: hidden; border-radius: 4px; display: flex; flex-direction: column; justify-content: center;">
  
  {%- comment %} BACKGROUND IMAGE LAYER {% endcomment -%}
  {%- if block.settings.image != blank -%}
    <div class="nrs-banner-img" style="position: absolute; inset: 0; z-index: 0;">
      {{ block.settings.image | image_url: width: 1400 | image_tag: loading: 'lazy', style: 'width:100%; height:100%; object-fit: cover; object-position: ' | append: bg_crop_pos | append: ';' }}
    </div>
  {%- endif -%}

  <div class="nrs-banner-content" style="
      position: relative; 
      z-index: 1; 
      width: 100%; 
      height: 100%;
      padding: {{ pad_v }}px {{ pad_h }}px !important;
      display: flex; 
      flex-direction: column; 
      justify-content: center; 
      align-items: {{ align_items }}; 
      text-align: {{ text_align }};
      box-sizing: border-box;
    ">
    
    {%- comment %} 
       FOREGROUND IMAGE LAYER (Vertical Only) 
    {% endcomment -%}
    {%- if is_vertical and block.settings.fg_image != blank -%}
      
      {%- assign fg_align_self = 'center' -%}
      {%- if block.settings.fg_align == 'left' -%}
        {%- assign fg_align_self = 'flex-start' -%}
      {%- elsif block.settings.fg_align == 'right' -%}
        {%- assign fg_align_self = 'flex-end' -%}
      {%- endif -%}

      <div class="nrs-fg-image-wrapper" style="
          width: {{ block.settings.fg_width }}px; 
          margin-bottom: 20px; 
          align-self: {{ fg_align_self }};
          {% if block.settings.fg_aspect != 'original' %}
            aspect-ratio: {{ block.settings.fg_aspect }}; overflow: hidden;
          {% endif %}
        ">
        {%- if block.settings.fg_aspect == 'original' -%}
          {{ block.settings.fg_image | image_url: width: 800 | image_tag: loading: 'lazy', style: 'width: 100%; height: auto; display: block;' }}
        {%- else -%}
          {{ block.settings.fg_image | image_url: width: 800 | image_tag: loading: 'lazy', style: 'width: 100%; height: 100%; object-fit: cover; object-position: ' | append: block.settings.fg_crop }}
        {%- endif -%}
      </div>
    {%- endif -%}

    {%- if block.settings.title != blank -%}
      {%- assign clean_title = block.settings.title | strip -%}
      {%- if clean_title != blank -%}
        <h3 style="
          font-size: {{ block.settings.title_size }}px; 
          color: {{ block.settings.title_color }}; 
          font-weight: bold; margin: 0 0 15px 0; line-height: 1.2;">
          {{ block.settings.title }}
        </h3>
      {%- endif -%}
    {%- endif -%}
    
    {%- if block.settings.desc != blank -%}
      {%- assign clean_desc = block.settings.desc | strip -%}
      {%- if clean_desc != blank -%}
        <p style="
          font-size: {{ block.settings.desc_size }}px; 
          color: {{ block.settings.desc_color }}; 
          margin: 0 0 25px 0; line-height: 1.5;">
          {{ block.settings.desc }}
        </p>
      {%- endif -%}
    {%- endif -%}
    
    {%- if block.settings.btn_text != blank -%}
      {%- assign clean_btn = block.settings.btn_text | strip -%}
      {%- if clean_btn != blank -%}
        {%- assign btn_bg = block.settings.btn_bg | default: '#000' -%}
        {%- assign btn_text_col = block.settings.btn_text_color | default: '#fff' -%}
        {%- assign safe_link = block.settings.link_url | default: '#' -%}
        
        <a href="{{ safe_link }}" style="
          padding: 12px 28px; 
          background-color: {{ btn_bg }} !important; 
          color: {{ btn_text_col }} !important; 
          text-decoration: none; font-weight: 600; border-radius: 4px; display: inline-block; position: relative; z-index: 3; margin-top: 15px;">
          {{ block.settings.btn_text }}
        </a>
      {%- endif -%}
    {%- endif -%}
  </div>

  {%- if link_scope == 'individual' and block.settings.link_url != blank and block.settings.btn_text == blank -%}
    <a href="{{ block.settings.link_url }}" class="nrs-link-overlay" style="position:absolute; inset:0; z-index:2;"></a>
  {%- endif -%}
</div>